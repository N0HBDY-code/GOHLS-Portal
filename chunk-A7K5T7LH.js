import{c as K}from"./chunk-HCFPR3S6.js";import{a as oe}from"./chunk-35X4EZSD.js";import{$a as B,$b as ee,Aa as U,Da as _,Jb as z,Kb as G,Kc as I,L as M,Mc as re,Nb as J,Nc as y,Oa as c,P as D,Pa as a,Pc as w,Qa as r,Qc as $,Ra as A,Rc as h,Sb as Q,Ub as X,V as f,Vc as C,W as g,Xa as S,Xb as Z,Xc as q,Ya as v,Yc as E,Za as m,_c as ne,a as x,ab as F,ac as te,b as O,bc as ie,c as p,cb as s,db as P,eb as u,fb as k,fc as ae,gb as W,hb as N,ib as V,jb as R,na as H,qa as l,ua as b}from"./chunk-ENPAMTHP.js";var j=class n{constructor(t){this.firestore=t}makeOffer(t){return p(this,null,function*(){let e=O(x({},t),{status:"pending",timestamp:new Date});yield re(y(this.firestore,"contractOffers"),e)})}getOffersForPlayer(t){return p(this,null,function*(){let e=y(this.firestore,"contractOffers"),i=C(e,E("playerId","==",t));return(yield h(i)).docs.map(d=>x({id:d.id},d.data()))})}getOffersForTeam(t){return p(this,null,function*(){let e=y(this.firestore,"contractOffers"),i=C(e,E("teamId","==",t));return(yield h(i)).docs.map(d=>x({id:d.id},d.data()))})}acceptOffer(t,e){return p(this,null,function*(){let i=w(this.firestore,`players/${t}`);yield q(i,{teamId:e.teamId,salary:e.salary,contractYears:e.years,signingBonus:e.signingBonus,performanceBonus:e.performanceBonus,noTradeClause:e.noTradeClause,contractExpiration:new Date().setFullYear(new Date().getFullYear()+e.years)});let o=w(this.firestore,`teams/${e.teamId}/roster/${t}`);yield q(o,{salary:e.salary,contractYears:e.years,signingBonus:e.signingBonus,performanceBonus:e.performanceBonus,noTradeClause:e.noTradeClause})})}static \u0275fac=function(e){return new(e||n)(D(I))};static \u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})};var L=class n{constructor(t){this.firestore=t}getFreeAgents(){return p(this,null,function*(){let t=y(this.firestore,"players"),e=C(t,E("teamId","==","none"));return(yield h(e)).docs.map(o=>x({id:o.id},o.data()))})}getExpiredContracts(){return p(this,null,function*(){let t=new Date,e=y(this.firestore,"players"),i=C(e,E("contractExpiration","<=",t));return(yield h(i)).docs.map(d=>x({id:d.id},d.data()))})}static \u0275fac=function(e){return new(e||n)(D(I))};static \u0275prov=M({token:n,factory:n.\u0275fac,providedIn:"root"})};function pe(n,t){if(n&1&&A(0,"img",14),n&2){let e=m();c("src",e.teamLogo,H)("alt",e.teamName)}}function fe(n,t){if(n&1){let e=S();a(0,"button",15),v("click",function(){f(e);let o=m();return g(o.showManageModal=!0)}),s(1," Manage Team "),r()}}function ge(n,t){if(n&1&&(a(0,"option",40),s(1),r()),n&2){let e=t.$implicit;c("value",e.id),l(),u(" ",e.name," ")}}function _e(n,t){if(n&1&&(a(0,"li"),s(1),r()),n&2){let e=t.$implicit,i=m(4);l(),u(" ",i.getPlayerName(e)," ")}}function ue(n,t){if(n&1&&(a(0,"li"),s(1),r()),n&2){let e=t.$implicit,i=m(4);l(),u(" ",i.getPlayerName(e)," ")}}function ve(n,t){if(n&1){let e=S();a(0,"div",41)(1,"p")(2,"strong"),s(3,"From:"),r(),s(4),r(),a(5,"p")(6,"strong"),s(7,"Offered Players:"),r()(),a(8,"ul"),_(9,_e,2,1,"li",12),r(),a(10,"p")(11,"strong"),s(12,"Requested Players:"),r()(),a(13,"ul"),_(14,ue,2,1,"li",12),r(),a(15,"div",42)(16,"button",43),v("click",function(){let o=f(e).$implicit,d=m(3);return g(d.acceptTrade(o))}),s(17,"Accept"),r(),a(18,"button",44),v("click",function(){let o=f(e).$implicit,d=m(3);return g(d.rejectTrade(o))}),s(19,"Reject"),r()()()}if(n&2){let e=t.$implicit,i=m(3);l(4),u(" ",i.getTeamName(e.fromTeamId)),l(5),c("ngForOf",e.playersOffered),l(5),c("ngForOf",e.playersRequested)}}function ye(n,t){n&1&&(a(0,"p",45),s(1," No incoming trade offers "),r())}function he(n,t){if(n&1){let e=S();a(0,"div",46)(1,"div",47)(2,"input",48),R("ngModelChange",function(o){let d=f(e).$implicit;return V(d.selected,o)||(d.selected=o),g(o)}),v("change",function(){f(e);let o=m(3);return g(o.updateTradeSummary())}),r(),a(3,"label",49),s(4),a(5,"small",45),s(6),r()()()()}if(n&2){let e=t.$implicit;l(2),c("id","your-"+e.id),N("ngModel",e.selected),l(),c("for","your-"+e.id),l(),W(" #",e.number," ",e.firstName," ",e.lastName," "),l(2),u("(",e.position,")")}}function xe(n,t){if(n&1){let e=S();a(0,"div",46)(1,"div",47)(2,"input",48),R("ngModelChange",function(o){let d=f(e).$implicit;return V(d.selected,o)||(d.selected=o),g(o)}),v("change",function(){f(e);let o=m(3);return g(o.updateTradeSummary())}),r(),a(3,"label",49),s(4),a(5,"small",45),s(6),r()()()()}if(n&2){let e=t.$implicit;l(2),c("id","partner-"+e.id),N("ngModel",e.selected),l(),c("for","partner-"+e.id),l(),W(" #",e.number," ",e.firstName," ",e.lastName," "),l(2),u("(",e.position,")")}}function Te(n,t){if(n&1&&(a(0,"li"),s(1),r()),n&2){let e=t.$implicit;l(),k(" ",e.firstName," ",e.lastName," ")}}function be(n,t){if(n&1&&(a(0,"li"),s(1),r()),n&2){let e=t.$implicit;l(),k(" ",e.firstName," ",e.lastName," ")}}function Se(n,t){if(n&1){let e=S();a(0,"div")(1,"div",27)(2,"div",28)(3,"div",7)(4,"div",8)(5,"h6",4),s(6,"Select Trade Partner"),r()(),a(7,"div",29)(8,"select",30),R("ngModelChange",function(o){f(e);let d=m(2);return V(d.selectedTradePartner,o)||(d.selectedTradePartner=o),g(o)}),v("change",function(){f(e);let o=m(2);return g(o.onTradePartnerSelect())}),a(9,"option",31),s(10,"Choose a team..."),r(),_(11,ge,2,2,"option",32),r()()(),a(12,"div",33)(13,"div",8)(14,"h6",4),s(15,"Incoming Trade Offers"),r()(),a(16,"div",29),_(17,ve,20,3,"div",34)(18,ye,2,0,"p",35),r()()(),a(19,"div",36)(20,"div",27)(21,"div",37)(22,"div",7)(23,"div",8)(24,"h6",4),s(25,"Your Players"),r()(),a(26,"div",29),_(27,he,7,7,"div",38),r()()(),a(28,"div",37)(29,"div",7)(30,"div",8)(31,"h6",4),s(32),r()(),a(33,"div",29),_(34,xe,7,7,"div",38),r()()()(),a(35,"div",33)(36,"div",8)(37,"h6",4),s(38,"Trade Summary"),r()(),a(39,"div",29)(40,"div",27)(41,"div",37)(42,"h6"),s(43),r(),a(44,"ul"),_(45,Te,2,2,"li",12),r()(),a(46,"div",37)(47,"h6"),s(48),r(),a(49,"ul"),_(50,be,2,2,"li",12),r()()(),a(51,"button",39),v("click",function(){f(e);let o=m(2);return g(o.proposeTrade())}),s(52," Propose Trade "),r()()()()()()}if(n&2){let e=m(2);l(8),N("ngModel",e.selectedTradePartner),l(3),c("ngForOf",e.availableTradePartners),l(6),c("ngForOf",e.incomingTradeOffers),l(),c("ngIf",e.incomingTradeOffers.length===0),l(9),c("ngForOf",e.yourPlayers),l(5),u("",e.getTeamName(e.selectedTradePartner)," Players"),l(2),c("ngForOf",e.partnerPlayers),l(9),u("",e.teamName," receives:"),l(2),c("ngForOf",e.getSelectedPartnerPlayers()),l(3),u("",e.getTeamName(e.selectedTradePartner)," receives:"),l(2),c("ngForOf",e.getSelectedYourPlayers()),l(),c("disabled",!e.canProposeTrade())}}function we(n,t){n&1&&(a(0,"div")(1,"h6"),s(2,"Contract Management"),r()())}function Pe(n,t){n&1&&(a(0,"div")(1,"h6"),s(2,"Available Free Agents"),r()())}function Ie(n,t){if(n&1){let e=S();a(0,"div",16)(1,"div",17)(2,"div",18)(3,"div",19)(4,"h5",20),s(5),r(),a(6,"button",21),v("click",function(){f(e);let o=m();return g(o.showManageModal=!1)}),r()(),a(7,"div",22)(8,"ul",23)(9,"li",24)(10,"a",25),v("click",function(){f(e);let o=m();return g(o.currentTab="trades")}),s(11," Trade Center "),r()(),a(12,"li",24)(13,"a",25),v("click",function(){f(e);let o=m();return g(o.currentTab="contracts")}),s(14," Contracts "),r()(),a(15,"li",24)(16,"a",25),v("click",function(){f(e);let o=m();return g(o.currentTab="freeagents")}),s(17," Free Agents "),r()()(),_(18,Se,53,12,"div",26)(19,we,3,0,"div",26)(20,Pe,3,0,"div",26),r()()()()}if(n&2){let e=m();l(5),u("Manage ",e.teamName),l(5),F("active",e.currentTab==="trades"),l(3),F("active",e.currentTab==="contracts"),l(3),F("active",e.currentTab==="freeagents"),l(2),c("ngIf",e.currentTab==="trades"),l(),c("ngIf",e.currentTab==="contracts"),l(),c("ngIf",e.currentTab==="freeagents")}}function Ce(n,t){if(n&1&&(a(0,"tr")(1,"td"),s(2),r(),a(3,"td"),s(4),r(),a(5,"td")(6,"span",50),s(7),r()(),a(8,"td"),s(9),r(),a(10,"td"),s(11),r(),a(12,"td")(13,"span",50),s(14),r()(),a(15,"td"),s(16),r(),a(17,"td"),s(18),r(),a(19,"td"),s(20),r()()),n&2){let e=t.$implicit,i=m();l(2),P(e.number),l(2),k("",e.firstName," ",e.lastName),l(2),B("background-color",i.getPositionColor(e.position)),l(),u(" ",e.position," "),l(2),P(e.archetype),l(2),P(e.age),l(2),B("background-color",i.getOverallColor(e.overall||50))("color",(e.overall||50)>=75?"white":"black"),l(),u(" ",e.overall||50," "),l(2),u("",e.height||"-",'"'),l(2),u("",e.weight||"-"," lbs"),l(2),P(e.handedness||"-")}}function Ee(n,t){n&1&&(a(0,"div",51),A(1,"i",52),a(2,"h5"),s(3,"No Players on Roster"),r(),a(4,"p"),s(5,"This team doesn't have any players yet."),r()())}var de=class n{constructor(t,e,i,o,d,T){this.route=t;this.firestore=e;this.authService=i;this.contractService=o;this.tradeService=d;this.freeAgencyService=T;this.teamId=this.route.snapshot.paramMap.get("id")}teamId;teamName="";teamLogo="";canManageTeam=!1;showManageModal=!1;currentTab="trades";isLoading=!1;roster=[];selectedTradePartner="";availableTradePartners=[];yourPlayers=[];partnerPlayers=[];incomingTradeOffers=[];loadingTrades=!1;playerCache=new Map;ngOnInit(){return p(this,null,function*(){this.isLoading=!0;try{if(this.authService.effectiveRoles.subscribe(t=>{this.canManageTeam=t.some(e=>["developer","commissioner","gm"].includes(e))}),this.teamId){let t=w(this.firestore,`teams/${this.teamId}`),e=yield $(t);if(e.exists()){let i=e.data();this.teamName=`${i.city} ${i.mascot}`,this.teamLogo=i.logoUrl||""}yield this.loadRoster(),yield this.loadTradePartners(),yield this.loadIncomingTradeOffers()}}finally{this.isLoading=!1}})}loadRoster(){return p(this,null,function*(){try{let t=y(this.firestore,`teams/${this.teamId}/roster`),e=yield h(t);this.roster=yield Promise.all(e.docs.map(i=>p(this,null,function*(){let o=i.data(),d=50;try{let T=w(this.firestore,`players/${i.id}/meta/attributes`),Y=yield $(T);Y.exists()&&(d=Y.data().OVERALL||50)}catch(T){console.error("Error loading player attributes:",T)}return{id:i.id,firstName:o.firstName||"",lastName:o.lastName||"",position:o.position||"",number:o.jerseyNumber||0,archetype:o.archetype||"",age:o.age||19,height:o.height||"",weight:o.weight||"",handedness:o.handedness||"",teamId:this.teamId,overall:d}})))}catch(t){console.error("Error loading roster:",t)}})}loadTradePartners(){return p(this,null,function*(){let t=y(this.firestore,"teams"),e=yield h(t);this.availableTradePartners=e.docs.map(i=>({id:i.id,name:`${i.data().city} ${i.data().mascot}`,city:i.data().city,mascot:i.data().mascot})).filter(i=>i.id!==this.teamId)})}loadIncomingTradeOffers(){return p(this,null,function*(){this.loadingTrades=!0;try{let t=yield this.tradeService.getTradeOffersForTeam(this.teamId);this.incomingTradeOffers=t.filter(i=>i.status==="pending");let e=new Set([...this.incomingTradeOffers.flatMap(i=>i.playersOffered),...this.incomingTradeOffers.flatMap(i=>i.playersRequested)]);if(e.size>0)for(let i of e){let o=w(this.firestore,`players/${i}`),d=yield $(o);if(d.exists()){let T=d.data();this.playerCache.set(i,`${T.firstName} ${T.lastName}`)}}}finally{this.loadingTrades=!1}})}onTradePartnerSelect(){return p(this,null,function*(){if(this.selectedTradePartner){this.isLoading=!0;try{let[t,e]=yield Promise.all([h(y(this.firestore,`teams/${this.teamId}/roster`)),h(y(this.firestore,`teams/${this.selectedTradePartner}/roster`))]);this.yourPlayers=t.docs.map(i=>O(x({},i.data()),{id:i.id,selected:!1})),this.partnerPlayers=e.docs.map(i=>O(x({},i.data()),{id:i.id,selected:!1}))}finally{this.isLoading=!1}}})}getTeamName(t){if(t===this.teamId)return this.teamName;let e=this.availableTradePartners.find(i=>i.id===t);return e?`${e.city} ${e.mascot}`:"Unknown Team"}getPlayerName(t){return this.playerCache.get(t)||"Loading..."}getSelectedYourPlayers(){return this.yourPlayers.filter(t=>t.selected)}getSelectedPartnerPlayers(){return this.partnerPlayers.filter(t=>t.selected)}updateTradeSummary(){}canProposeTrade(){return this.getSelectedYourPlayers().length>0||this.getSelectedPartnerPlayers().length>0}proposeTrade(){return p(this,null,function*(){if(this.selectedTradePartner){this.isLoading=!0;try{let t={fromTeamId:this.teamId,toTeamId:this.selectedTradePartner,playersOffered:this.getSelectedYourPlayers().map(e=>e.id),playersRequested:this.getSelectedPartnerPlayers().map(e=>e.id)};yield this.tradeService.proposeTrade(t),this.yourPlayers.forEach(e=>e.selected=!1),this.partnerPlayers.forEach(e=>e.selected=!1),alert("Trade proposal sent successfully!")}catch(t){console.error("Error proposing trade:",t),alert("Failed to propose trade. Please try again.")}finally{this.isLoading=!1}}})}acceptTrade(t){return p(this,null,function*(){this.isLoading=!0;try{yield this.tradeService.acceptTrade(t),yield this.loadIncomingTradeOffers(),alert("Trade accepted successfully!")}catch(e){console.error("Error accepting trade:",e),alert("Failed to accept trade. Please try again.")}finally{this.isLoading=!1}})}rejectTrade(t){return p(this,null,function*(){this.isLoading=!0;try{yield this.tradeService.rejectTrade(t),yield this.loadIncomingTradeOffers(),alert("Trade rejected successfully!")}catch(e){console.error("Error rejecting trade:",e),alert("Failed to reject trade. Please try again.")}finally{this.isLoading=!1}})}getPositionColor(t){switch(t){case"G":return"#dc3545";case"D":return"#fd7e14";case"C":return"#28a745";case"LW":return"#17a2b8";case"RW":return"#007bff";default:return"#6c757d"}}getOverallColor(t){let i=(Math.max(50,Math.min(99,t))-50)/49,o=Math.round(220-186*i),d=Math.round(38+159*i),T=Math.round(38+56*i);return`rgb(${o}, ${d}, ${T})`}static \u0275fac=function(e){return new(e||n)(b(K),b(I),b(ne),b(j),b(oe),b(L))};static \u0275cmp=U({type:n,selectors:[["app-team-detail"]],decls:38,vars:6,consts:[[1,"container","mt-4"],[1,"team-header","mb-4","d-flex","align-items-center","justify-content-between"],[1,"d-flex","align-items-center","gap-3"],["class","team-logo",3,"src","alt",4,"ngIf"],[1,"mb-0"],["class","btn btn-primary",3,"click",4,"ngIf"],["class","modal fade show","tabindex","-1","style","display: block; background: rgba(0,0,0,0.5);",4,"ngIf"],[1,"card"],[1,"card-header"],[1,"card-body","p-0"],[1,"table-responsive"],[1,"table","table-striped","table-hover","mb-0"],[4,"ngFor","ngForOf"],["class","text-center py-4 text-muted",4,"ngIf"],[1,"team-logo",3,"src","alt"],[1,"btn","btn-primary",3,"click"],["tabindex","-1",1,"modal","fade","show",2,"display","block","background","rgba(0,0,0,0.5)"],[1,"modal-dialog","modal-xl"],[1,"modal-content"],[1,"modal-header"],[1,"modal-title"],["type","button",1,"btn-close",3,"click"],[1,"modal-body"],[1,"nav","nav-tabs","mb-3"],[1,"nav-item"],[1,"nav-link",3,"click"],[4,"ngIf"],[1,"row"],[1,"col-md-4"],[1,"card-body"],[1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"card","mt-3"],["class","trade-offer mb-2",4,"ngFor","ngForOf"],["class","text-muted",4,"ngIf"],[1,"col-md-8"],[1,"col-md-6"],["class","player-item",4,"ngFor","ngForOf"],[1,"btn","btn-primary",3,"click","disabled"],[3,"value"],[1,"trade-offer","mb-2"],[1,"d-flex","gap-2"],[1,"btn","btn-success","btn-sm",3,"click"],[1,"btn","btn-danger","btn-sm",3,"click"],[1,"text-muted"],[1,"player-item"],[1,"form-check"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","id","ngModel"],[1,"form-check-label",3,"for"],[1,"badge"],[1,"text-center","py-4","text-muted"],[1,"fas","fa-users","fa-3x","mb-3"]],template:function(e,i){e&1&&(a(0,"div",0)(1,"div",1)(2,"div",2),_(3,pe,1,2,"img",3),a(4,"h2",4),s(5),r()(),_(6,fe,2,0,"button",5),r(),_(7,Ie,21,10,"div",6),a(8,"div",7)(9,"div",8)(10,"h5",4),s(11,"Team Roster"),r()(),a(12,"div",9)(13,"div",10)(14,"table",11)(15,"thead")(16,"tr")(17,"th"),s(18,"#"),r(),a(19,"th"),s(20,"Name"),r(),a(21,"th"),s(22,"Position"),r(),a(23,"th"),s(24,"Archetype"),r(),a(25,"th"),s(26,"Age"),r(),a(27,"th"),s(28,"Overall"),r(),a(29,"th"),s(30,"Height"),r(),a(31,"th"),s(32,"Weight"),r(),a(33,"th"),s(34,"Hand"),r()()(),a(35,"tbody"),_(36,Ce,21,16,"tr",12),r()()(),_(37,Ee,6,0,"div",13),r()()()),e&2&&(l(3),c("ngIf",i.teamLogo),l(2),P(i.teamName),l(),c("ngIf",i.canManageTeam),l(),c("ngIf",i.showManageModal),l(29),c("ngForOf",i.roster),l(),c("ngIf",i.roster.length===0))},dependencies:[J,z,G,ae,te,ie,Q,ee,X,Z],styles:[".team-logo[_ngcontent-%COMP%]{width:80px;height:80px;object-fit:contain}.team-header[_ngcontent-%COMP%]{background:#fff;padding:1rem;border-radius:8px;box-shadow:0 2px 4px #0000001a}.nav-tabs[_ngcontent-%COMP%]   .nav-link[_ngcontent-%COMP%]{cursor:pointer;color:#6c757d}.nav-tabs[_ngcontent-%COMP%]   .nav-link.active[_ngcontent-%COMP%]{color:#0d6efd;font-weight:500}.modal-dialog[_ngcontent-%COMP%]{max-width:90%}.modal-content[_ngcontent-%COMP%]{border-radius:12px;border:none;box-shadow:0 10px 30px #0000004d}.modal-header[_ngcontent-%COMP%]{border-bottom:1px solid #dee2e6;padding:1rem 1.5rem}.modal-body[_ngcontent-%COMP%]{padding:1.5rem}.player-item[_ngcontent-%COMP%]{padding:.5rem;border-bottom:1px solid #eee}.player-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.trade-offer[_ngcontent-%COMP%]{padding:1rem;border:1px solid #dee2e6;border-radius:8px;background:#f8f9fa}.trade-offer[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin-bottom:.5rem;padding-left:1.5rem}.trade-offer[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:.25rem}"]})};export{de as TeamDetail};
