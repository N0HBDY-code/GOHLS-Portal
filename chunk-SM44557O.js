import{Jc as w,L as h,Lc as g,Mc as n,Oc as o,P as y,Pc as R,Qc as m,Uc as T,Wc as c,Xc as l,Yc as O,a as d,b as p,c as s}from"./chunk-75EH5XHB.js";var v=class f{constructor(e){this.firestore=e}proposeTrade(e){return s(this,null,function*(){let t=p(d({},e),{status:"pending",timestamp:new Date,fromTeamAccepted:!0,toTeamAccepted:!1});yield g(n(this.firestore,"tradeOffers"),t)})}getTradeOffersForTeam(e){return s(this,null,function*(){let t=n(this.firestore,"tradeOffers"),r=T(t,l("toTeamId","==",e));return(yield m(r)).docs.map(i=>d({id:i.id},i.data()))})}getPendingTradeApprovals(){return s(this,null,function*(){let e=n(this.firestore,"tradeOffers"),t=T(e,l("status","==","awaiting_approval"));return(yield m(t)).docs.map(a=>d({id:a.id},a.data()))})}acceptTrade(e){return s(this,null,function*(){if(!e.id)return;let t=o(this.firestore,"tradeOffers",e.id);if(e.toTeamId===e.fromTeamId)throw new Error("Cannot trade with the same team");let r={toTeamAccepted:!0};e.fromTeamAccepted&&(r.status="awaiting_approval"),yield c(t,r)})}approveTrade(e){return s(this,null,function*(){if(!e.id)return;let t=O(this.firestore),r=o(this.firestore,`tradeOffers/${e.id}`);if(t.update(r,{status:"approved"}),e.playersOffered.length>0)for(let a of e.playersOffered)yield this.addPlayerToBatch(t,a,e.fromTeamId,e.toTeamId);if(e.playersRequested.length>0)for(let a of e.playersRequested)yield this.addPlayerToBatch(t,a,e.toTeamId,e.fromTeamId);yield t.commit()})}denyTrade(e){return s(this,null,function*(){if(!e.id)return;let t=o(this.firestore,`tradeOffers/${e.id}`);yield c(t,{status:"denied"})})}rejectTrade(e){return s(this,null,function*(){if(!e.id)return;let t=o(this.firestore,`tradeOffers/${e.id}`);yield c(t,{status:"rejected",toTeamAccepted:!1,fromTeamAccepted:!1})})}addPlayerToBatch(e,t,r,a){return s(this,null,function*(){let i=o(this.firestore,`teams/${r}/roster/${t}`),u=yield R(i);if(!u.exists()){console.warn(`Player ${t} not found in team ${r}'s roster`);return}let I=u.data(),$=o(this.firestore,`players/${t}`),A=o(this.firestore,`teams/${a}/roster/${t}`);e.update($,{teamId:a}),e.delete(i),e.set(A,p(d({},I),{teamId:a}))})}static \u0275fac=function(t){return new(t||f)(y(w))};static \u0275prov=h({token:f,factory:f.\u0275fac,providedIn:"root"})};export{v as a};
